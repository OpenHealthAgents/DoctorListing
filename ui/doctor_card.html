<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor Search Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6;
      }
      .card {
        transition: all 0.2s;
      }
      .card:hover {
        transform: translateY(-2px);
        box-shadow:
          0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
    </style>
  </head>
  <body class="p-4">
    <div id="container" class="max-w-4xl mx-auto space-y-4">
      <!-- Loading State -->
      <div id="loading" class="text-center py-10 text-gray-500 hidden">
        <svg
          class="animate-spin h-8 w-8 mx-auto mb-2 text-blue-500"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
        Searching for doctors...
      </div>

      <!-- No Results -->
      <div
        id="no-results"
        class="hidden text-center py-10 bg-white rounded-xl shadow-sm border border-gray-100"
      >
        <p class="text-gray-500 text-lg">
          No doctors found matching your criteria.
        </p>
        <p class="text-gray-400 text-sm mt-1">Try broadening your search.</p>
      </div>

      <!-- Results Grid -->
      <div
        id="results-grid"
        class="grid grid-cols-1 md:grid-cols-2 gap-4"
      ></div>
    </div>

    <script>
      const container = document.getElementById("results-grid");
      const noResults = document.getElementById("no-results");
      const loading = document.getElementById("loading");

      loading.classList.remove("hidden");

      function render(data) {
        loading.classList.add("hidden");
        container.innerHTML = "";

        let doctors = data?.results ?? data;

        if (!Array.isArray(doctors)) {
          doctors = [];
        }

        if (doctors.length === 0) {
          noResults.classList.remove("hidden");
          return;
        } else {
          noResults.classList.add("hidden");
        }

        doctors.forEach((doc) => {
          const card = document.createElement("div");
          card.className =
            "card bg-white p-5 rounded-xl border border-gray-200 shadow-sm flex flex-col justify-between h-full";

          const initials = doc.name
            ? doc.name
                .split(" ")
                .map((n) => n[0])
                .join("")
                .substring(0, 2)
                .toUpperCase()
            : "DR";

          card.innerHTML = `
                <div>
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-sm">
                                ${initials}
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">${doc.name || "Unknown Doctor"}</h3>
                                <p class="text-xs text-blue-600 font-medium uppercase tracking-wide">
                                    ${doc.specialty || "General Practice"}
                                </p>
                            </div>
                        </div>
                        ${doc.credential ? `<span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-md font-medium">${doc.credential}</span>` : ""}
                    </div>

                    <div class="space-y-2 mt-4 text-sm text-gray-600">
                        ${
                          doc.phone
                            ? `
                            <div class="flex items-center space-x-2">
                                <span>${doc.phone}</span>
                            </div>`
                            : ""
                        }

                        ${
                          doc.city || doc.state
                            ? `
                            <div class="flex items-start space-x-2">
                                <span>${[doc.city, doc.state].filter(Boolean).join(", ")}</span>
                            </div>`
                            : ""
                        }
                    </div>
                </div>

                <div class="mt-5 pt-4 border-t border-gray-100 flex justify-between items-center">
                    <span class="text-xs text-gray-400">NPI: ${doc.npi || "N/A"}</span>
                    <button class="text-sm text-blue-600 font-medium">View Details â†’</button>
                </div>
            `;
          container.appendChild(card);
        });
      }

      if (window.openai) {
        if (window.openai.toolOutput) {
          render(window.openai.toolOutput);
        }

        if (window.openai.onToolOutput) {
          window.openai.onToolOutput(render);
        }
      } else {
        console.log("OpenAI Apps SDK environment not detected.");
      }
    </script>
  </body>
</html>
